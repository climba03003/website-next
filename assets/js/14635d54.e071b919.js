"use strict";(self.webpackChunk_fastify_website=self.webpackChunk_fastify_website||[]).push([[19247],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=r.createContext({}),l=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=l(n),f=i,m=c["".concat(p,".").concat(f)]||c[f]||d[f]||a;return n?r.createElement(m,o(o({ref:t},u),{},{components:n})):r.createElement(m,o({ref:t},u))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=c;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var l=2;l<a;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},20517:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var r=n(87462),i=(n(67294),n(3905));const a={},o="V4 Migration Guide",s={unversionedId:"Guides/Migration-Guide-V4",id:"version-v4.0.x/Guides/Migration-Guide-V4",title:"V4 Migration Guide",description:"This guide is intended to help with migration from Fastify v3 to v4.",source:"@site/versioned_docs/version-v4.0.x/Guides/Migration-Guide-V4.md",sourceDirName:"Guides",slug:"/Guides/Migration-Guide-V4",permalink:"/website-next/docs/v4.0.x/Guides/Migration-Guide-V4",draft:!1,editUrl:"https://github.com/fastify/fastify/edit/main/docs/Guides/Migration-Guide-V4.md",tags:[],version:"v4.0.x",frontMatter:{},sidebar:"docsSidebar",previous:{title:"V3 Migration Guide",permalink:"/website-next/docs/v4.0.x/Guides/Migration-Guide-V3"},next:{title:"The hitchhiker's guide to plugins",permalink:"/website-next/docs/v4.0.x/Guides/Plugins-Guide"}},p={},l=[{value:"Breaking Changes",id:"breaking-changes",level:2},{value:"Deprecation of <code>app.use()</code>",id:"deprecation-of-appuse",level:3},{value:"Non Breaking Changes",id:"non-breaking-changes",level:2},{value:"Change of schema for multiple types",id:"change-of-schema-for-multiple-types",level:3}],u={toc:l};function d(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"v4-migration-guide"},"V4 Migration Guide"),(0,i.kt)("p",null,"This guide is intended to help with migration from Fastify v3 to v4."),(0,i.kt)("p",null,"Before migrating to v4, please ensure that you have fixed all deprecation\nwarnings from v3. All v3 deprecations have been removed and they will no longer\nwork after upgrading."),(0,i.kt)("h2",{id:"breaking-changes"},"Breaking Changes"),(0,i.kt)("h3",{id:"deprecation-of-appuse"},"Deprecation of ",(0,i.kt)("inlineCode",{parentName:"h3"},"app.use()")),(0,i.kt)("p",null,"Starting this version of Fastify, we have deprecated the use of ",(0,i.kt)("inlineCode",{parentName:"p"},"app.use()"),". We\nhave decided not to support the use of middlewares. Both\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/fastify/middie"},(0,i.kt)("inlineCode",{parentName:"a"},"@fastify/middie"))," and\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify-express"},(0,i.kt)("inlineCode",{parentName:"a"},"@fastify/express"))," will still be\nthere and maintained. Use Fastify's ",(0,i.kt)("a",{parentName:"p",href:"/website-next/docs/v4.0.x/Reference/Hooks"},"hooks")," instead."),(0,i.kt)("h2",{id:"non-breaking-changes"},"Non Breaking Changes"),(0,i.kt)("h3",{id:"change-of-schema-for-multiple-types"},"Change of schema for multiple types"),(0,i.kt)("p",null,'Since Fastify v4 has upgraded to Ajv v8. The "type" keywords with multiple types\n(other than with "null") are prohibited. Read more\n',(0,i.kt)("a",{parentName:"p",href:"https://ajv.js.org/strict-mode.html#strict-types"},"'here'")),(0,i.kt)("p",null,"You may encounter a console warning such as"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'strict mode: use allowUnionTypes to allow union type keyword at "#/properties/image" (strictTypes)\n')),(0,i.kt)("p",null,"So schemas like below will need to be changed from"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"type: 'object',\nproperties: {\n  api_key: { type: 'string' },\n  image: { type: ['object', 'array'] }\n  }\n}\n")),(0,i.kt)("p",null,"to"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"type: 'object',\nproperties: {\n  api_key: { type: 'string' },\n  image: {\n    anyOf: [\n      { type: 'array' },\n      { type: 'object' }\n    ]\n  }\n}\n")))}d.isMDXComponent=!0}}]);