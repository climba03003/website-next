"use strict";(self.webpackChunk_fastify_website=self.webpackChunk_fastify_website||[]).push([[35906],{3905:(e,t,n)=>{n.d(t,{Zo:()=>f,kt:()=>d});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},f=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},y=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,f=o(e,["components","mdxType","originalType","parentName"]),y=l(n),d=r,h=y["".concat(p,".").concat(d)]||y[d]||u[d]||i;return n?a.createElement(h,s(s({ref:t},f),{},{components:n})):a.createElement(h,s({ref:t},f))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=y;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var l=2;l<i;l++)s[l]=n[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}y.displayName="MDXCreateElement"},51427:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>l});var a=n(87462),r=(n(67294),n(3905));const i={},s=void 0,o={unversionedId:"Reference/TypeScript",id:"version-v4.0.x/Reference/TypeScript",title:"TypeScript",description:"TypeScript",source:"@site/versioned_docs/version-v4.0.x/Reference/TypeScript.md",sourceDirName:"Reference",slug:"/Reference/TypeScript",permalink:"/website-next/docs/v4.0.x/Reference/TypeScript",draft:!1,editUrl:"https://github.com/fastify/fastify/edit/main/docs/Reference/TypeScript.md",tags:[],version:"v4.0.x",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Type-Providers",permalink:"/website-next/docs/v4.0.x/Reference/Type-Providers"},next:{title:"Validation-and-Serialization",permalink:"/website-next/docs/v4.0.x/Reference/Validation-and-Serialization"}},p={},l=[{value:"TypeScript",id:"typescript",level:2},{value:"Learn By Example",id:"learn-by-example",level:2},{value:"Getting Started",id:"getting-started",level:3},{value:"Using Generics",id:"using-generics",level:3},{value:"JSON Schema",id:"json-schema",level:3},{value:"Fastify Type Providers",id:"fastify-type-providers",level:4},{value:"typebox",id:"typebox",level:4},{value:"Schemas in JSON Files",id:"schemas-in-json-files",level:4},{value:"json-schema-to-ts",id:"json-schema-to-ts",level:4},{value:"Plugins",id:"plugins",level:3},{value:"Creating a TypeScript Fastify Plugin",id:"creating-a-typescript-fastify-plugin",level:4},{value:"Creating Type Definitions for a Fastify Plugin",id:"creating-type-definitions-for-a-fastify-plugin",level:4},{value:"Using a Plugin",id:"using-a-plugin",level:4},{value:"Code Completion In Vanilla JavaScript",id:"code-completion-in-vanilla-javascript",level:2},{value:"API Type System Documentation",id:"api-type-system-documentation",level:2},{value:"How to import",id:"how-to-import",level:4},{value:"Generics",id:"generics",level:4},{value:"RawServer",id:"rawserver",level:5},{value:"RawRequest",id:"rawrequest",level:5},{value:"RawReply",id:"rawreply",level:5},{value:"Logger",id:"logger",level:5},{value:"RawBody",id:"rawbody",level:5},{value:"Fastify",id:"fastify",level:4},{value:"fastify&lt;RawServer, RawRequest, RawReply, Logger&gt;(opts?: FastifyServerOptions): FastifyInstance",id:"fastifyrawserver-rawrequest-rawreply-loggeropts-fastifyserveroptions-fastifyinstance",level:5},{value:"Example 1: Standard HTTP server",id:"example-1-standard-http-server",level:6},{value:"Example 2: HTTPS sever",id:"example-2-https-sever",level:6},{value:"Example 3: HTTP2 server",id:"example-3-http2-server",level:6},{value:"Example 4: Extended HTTP server",id:"example-4-extended-http-server",level:6},{value:"Example 5: Specifying logger types",id:"example-5-specifying-logger-types",level:6},{value:"fastify.HTTPMethods",id:"fastifyhttpmethods",level:5},{value:"fastify.RawServerBase",id:"fastifyrawserverbase",level:5},{value:"fastify.RawServerDefault",id:"fastifyrawserverdefault",level:5},{value:"fastify.FastifyServerOptions&lt;RawServer, Logger&gt;",id:"fastifyfastifyserveroptionsrawserver-logger",level:5},{value:"fastify.FastifyInstance&lt;RawServer, RawRequest, RequestGeneric, Logger&gt;",id:"fastifyfastifyinstancerawserver-rawrequest-requestgeneric-logger",level:5},{value:"Request",id:"request",level:4},{value:"fastify.FastifyRequest&lt;RequestGeneric, RawServer, RawRequest&gt;",id:"fastifyfastifyrequestrequestgeneric-rawserver-rawrequest",level:5},{value:"Example",id:"example",level:6},{value:"fastify.RequestGenericInterface",id:"fastifyrequestgenericinterface",level:5},{value:"fastify.RawRequestDefaultExpression&lt;RawServer&gt;",id:"fastifyrawrequestdefaultexpressionrawserver",level:5},{value:"Reply",id:"reply",level:4},{value:"fastify.FastifyReply&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;",id:"fastifyfastifyreplyrawserver-rawrequest-rawreply-requestgeneric-contextconfig",level:5},{value:"Example",id:"example-1",level:6},{value:"fastify.RawReplyDefaultExpression&lt;RawServer&gt;",id:"fastifyrawreplydefaultexpressionrawserver",level:5},{value:"Plugin",id:"plugin",level:4},{value:"fastify.FastifyPluginCallback&lt;Options&gt;",id:"fastifyfastifyplugincallbackoptions",level:5},{value:"fastify.FastifyPluginAsync&lt;Options&gt;",id:"fastifyfastifypluginasyncoptions",level:5},{value:"fastify.FastifyPlugin&lt;Options&gt;",id:"fastifyfastifypluginoptions",level:5},{value:"fastify.FastifyPluginOptions",id:"fastifyfastifypluginoptions-1",level:5},{value:"Register",id:"register",level:4},{value:"fastify.FastifyRegister(plugin: FastifyPluginCallback, opts: FastifyRegisterOptions)",id:"fastifyfastifyregisterplugin-fastifyplugincallback-opts-fastifyregisteroptions",level:5},{value:"fastify.FastifyRegister(plugin: FastifyPluginAsync, opts: FastifyRegisterOptions)",id:"fastifyfastifyregisterplugin-fastifypluginasync-opts-fastifyregisteroptions",level:5},{value:"fastify.FastifyRegister(plugin: FastifyPlugin, opts: FastifyRegisterOptions)",id:"fastifyfastifyregisterplugin-fastifyplugin-opts-fastifyregisteroptions",level:5},{value:"fastify.FastifyRegisterOptions",id:"fastifyfastifyregisteroptions",level:5},{value:"Logger",id:"logger-1",level:4},{value:"fastify.FastifyLoggerOptions&lt;RawServer, RawRequest, RawReply&gt;",id:"fastifyfastifyloggeroptionsrawserver-rawrequest-rawreply",level:5},{value:"fastify.FastifyLogFn",id:"fastifyfastifylogfn",level:5},{value:"fastify.LogLevel",id:"fastifyloglevel",level:5},{value:"Context",id:"context",level:4},{value:"fastify.FastifyContext",id:"fastifyfastifycontext",level:5},{value:"Routing",id:"routing",level:4},{value:"fastify.RouteHandlerMethod&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;",id:"fastifyroutehandlermethodrawserver-rawrequest-rawreply-requestgeneric-contextconfig",level:5},{value:"fastify.RouteOptions&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;",id:"fastifyrouteoptionsrawserver-rawrequest-rawreply-requestgeneric-contextconfig",level:5},{value:"fastify.RouteShorthandMethod&lt;RawServer, RawRequest, RawReply&gt;",id:"fastifyrouteshorthandmethodrawserver-rawrequest-rawreply",level:5},{value:"fastify.RouteShorthandOptions&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;",id:"fastifyrouteshorthandoptionsrawserver-rawrequest-rawreply-requestgeneric-contextconfig",level:5},{value:"fastify.RouteShorthandOptionsWithHandler&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;",id:"fastifyrouteshorthandoptionswithhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfig",level:5},{value:"Parsers",id:"parsers",level:4},{value:"RawBody",id:"rawbody-1",level:5},{value:"fastify.FastifyBodyParser&lt;RawBody, RawServer, RawRequest&gt;",id:"fastifyfastifybodyparserrawbody-rawserver-rawrequest",level:5},{value:"fastify.FastifyContentTypeParser&lt;RawServer, RawRequest&gt;",id:"fastifyfastifycontenttypeparserrawserver-rawrequest",level:5},{value:"fastify.AddContentTypeParser&lt;RawServer, RawRequest&gt;",id:"fastifyaddcontenttypeparserrawserver-rawrequest",level:5},{value:"fastify.hasContentTypeParser",id:"fastifyhascontenttypeparser",level:5},{value:"Errors",id:"errors",level:4},{value:"fastify.FastifyError",id:"fastifyfastifyerror",level:5},{value:"fastify.ValidationResult",id:"fastifyvalidationresult",level:5},{value:"Hooks",id:"hooks",level:4},{value:"fastify.onRequestHookHandler&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;(request: FastifyRequest, reply: FastifyReply, done: (err?: FastifyError) =&gt; void): Promise&lt;unknown&gt; | void",id:"fastifyonrequesthookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-done-err-fastifyerror--void-promiseunknown--void",level:5},{value:"fastify.preParsingHookHandler&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;(request: FastifyRequest, reply: FastifyReply, done: (err?: FastifyError) =&gt; void): Promise&lt;unknown&gt; | void",id:"fastifypreparsinghookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-done-err-fastifyerror--void-promiseunknown--void",level:5},{value:"fastify.preValidationHookHandler&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;(request: FastifyRequest, reply: FastifyReply, done: (err?: FastifyError) =&gt; void): Promise&lt;unknown&gt; | void",id:"fastifyprevalidationhookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-done-err-fastifyerror--void-promiseunknown--void",level:5},{value:"fastify.preHandlerHookHandler&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;(request: FastifyRequest, reply: FastifyReply, done: (err?: FastifyError) =&gt; void): Promise&lt;unknown&gt; | void",id:"fastifyprehandlerhookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-done-err-fastifyerror--void-promiseunknown--void",level:5},{value:"fastify.preSerializationHookHandler&lt;PreSerializationPayload, RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;(request: FastifyRequest, reply: FastifyReply, payload: PreSerializationPayload, done: (err: FastifyError | null, res?: unknown) =&gt; void): Promise&lt;unknown&gt; | void",id:"fastifypreserializationhookhandlerpreserializationpayload-rawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-payload-preserializationpayload-done-err-fastifyerror--null-res-unknown--void-promiseunknown--void",level:5},{value:"fastify.onSendHookHandler&lt;OnSendPayload, RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;(request: FastifyRequest, reply: FastifyReply, payload: OnSendPayload, done: (err: FastifyError | null, res?: unknown) =&gt; void): Promise&lt;unknown&gt; | void",id:"fastifyonsendhookhandleronsendpayload-rawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-payload-onsendpayload-done-err-fastifyerror--null-res-unknown--void-promiseunknown--void",level:5},{value:"fastify.onResponseHookHandler&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;(request: FastifyRequest, reply: FastifyReply, done: (err?: FastifyError) =&gt; void): Promise&lt;unknown&gt; | void",id:"fastifyonresponsehookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-done-err-fastifyerror--void-promiseunknown--void",level:5},{value:"fastify.onErrorHookHandler&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;(request: FastifyRequest, reply: FastifyReply, error: FastifyError, done: () =&gt; void): Promise&lt;unknown&gt; | void",id:"fastifyonerrorhookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-error-fastifyerror-done---void-promiseunknown--void",level:5},{value:"fastify.onRouteHookHandler&lt;RawServer, RawRequest, RawReply, RequestGeneric, ContextConfig&gt;(opts: RouteOptions &amp; { path: string; prefix: string }): Promise&lt;unknown&gt; | void",id:"fastifyonroutehookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigopts-routeoptions---path-string-prefix-string--promiseunknown--void",level:5},{value:"fastify.onRegisterHookHandler&lt;RawServer, RawRequest, RawReply, Logger&gt;(instance: FastifyInstance, done: (err?: FastifyError) =&gt; void): Promise&lt;unknown&gt; | void",id:"fastifyonregisterhookhandlerrawserver-rawrequest-rawreply-loggerinstance-fastifyinstance-done-err-fastifyerror--void-promiseunknown--void",level:5},{value:"fastify.onCloseHookHandler&lt;RawServer, RawRequest, RawReply, Logger&gt;(instance: FastifyInstance, done: (err?: FastifyError) =&gt; void): Promise&lt;unknown&gt; | void",id:"fastifyonclosehookhandlerrawserver-rawrequest-rawreply-loggerinstance-fastifyinstance-done-err-fastifyerror--void-promiseunknown--void",level:5}],f={toc:l};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},f,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"typescript"},"TypeScript"),(0,r.kt)("p",null,"The Fastify framework is written in vanilla JavaScript, and as such type\ndefinitions are not as easy to maintain; however, since version 2 and beyond,\nmaintainers and contributors have put in a great effort to improve the types."),(0,r.kt)("p",null,"The type system was changed in Fastify version 3. The new type system introduces\ngeneric constraining and defaulting, plus a new way to define schema types such\nas a request body, querystring, and more! As the team works on improving\nframework and type definition synergy, sometimes parts of the API will not be\ntyped or may be typed incorrectly. We encourage you to ",(0,r.kt)("strong",{parentName:"p"},"contribute")," to help us\nfill in the gaps. Just make sure to read our\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/CONTRIBUTING.md"},(0,r.kt)("inlineCode",{parentName:"a"},"CONTRIBUTING.md")),"\nfile before getting started to make sure things go smoothly!"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The documentation in this section covers Fastify version 3.x typings")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Plugins may or may not include typings. See ",(0,r.kt)("a",{parentName:"p",href:"#plugins"},"Plugins")," for more\ninformation. We encourage users to send pull requests to improve typings\nsupport.")),(0,r.kt)("p",null,"\ud83d\udea8 Don't forget to install ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/node")),(0,r.kt)("h2",{id:"learn-by-example"},"Learn By Example"),(0,r.kt)("p",null,"The best way to learn the Fastify type system is by example! The following four\nexamples should cover the most common Fastify development cases. After the\nexamples there is further, more detailed documentation for the type system."),(0,r.kt)("h3",{id:"getting-started"},"Getting Started"),(0,r.kt)("p",null,"This example will get you up and running with Fastify and TypeScript. It results\nin a blank http Fastify server."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a new npm project, install Fastify, and install typescript & node.js\ntypes as peer dependencies:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm init -y\nnpm i fastify\nnpm i -D typescript @types/node\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the following lines to the ",(0,r.kt)("inlineCode",{parentName:"p"},'"scripts"')," section of the ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "scripts": {\n    "build": "tsc -p tsconfig.json",\n    "start": "node index.js"\n  }\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Initialize a TypeScript configuration file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx tsc --init\n")),(0,r.kt)("p",{parentName:"li"},"or use one of the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/tsconfig/bases#node-14-tsconfigjson"},"recommended\nones"),"."))),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Note: Set ",(0,r.kt)("inlineCode",{parentName:"em"},"target")," property in ",(0,r.kt)("inlineCode",{parentName:"em"},"tsconfig.json")," to ",(0,r.kt)("inlineCode",{parentName:"em"},"es2017")," or greater to avoid\n",(0,r.kt)("a",{parentName:"em",href:"https://github.com/fastify/fastify/issues/3284"},"FastifyDeprecation")," warning.")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create an ",(0,r.kt)("inlineCode",{parentName:"p"},"index.ts")," file - this will contain the server code")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the following code block to your file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import fastify from 'fastify'\n\nconst server = fastify()\n\nserver.get('/ping', async (request, reply) => {\n  return 'pong\\n'\n})\n\nserver.listen({ port: 8080 }, (err, address) => {\n  if (err) {\n    console.error(err)\n    process.exit(1)\n  }\n  console.log(`Server listening at ${address}`)\n})\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run build")," - this will compile ",(0,r.kt)("inlineCode",{parentName:"p"},"index.ts")," into ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," which can\nbe executed using Node.js. If you run into any errors please open an issue in\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/help/"},"fastify/help"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run start")," to run the Fastify server")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"You should see ",(0,r.kt)("inlineCode",{parentName:"p"},"Server listening at http://127.0.0.1:8080")," in your console")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Try out your server using ",(0,r.kt)("inlineCode",{parentName:"p"},"curl localhost:8080/ping"),", it should return ",(0,r.kt)("inlineCode",{parentName:"p"},"pong"),"\n\ud83c\udfd3"))),(0,r.kt)("p",null,"\ud83c\udf89 You now have a working Typescript Fastify server! This example demonstrates\nthe simplicity of the version 3.x type system. By default, the type system\nassumes you are using an ",(0,r.kt)("inlineCode",{parentName:"p"},"http")," server. The later examples will demonstrate how\nto create more complex servers such as ",(0,r.kt)("inlineCode",{parentName:"p"},"https")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"http2"),", how to specify route\nschemas, and more!"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"For more examples on initializing Fastify with TypeScript (such as enabling\nHTTP2) check out the detailed API section ",(0,r.kt)("a",{parentName:"p",href:"#fastifyrawserver-rawrequest-rawreply-loggeropts-fastifyserveroptions-fastifyinstance"},"here"))),(0,r.kt)("h3",{id:"using-generics"},"Using Generics"),(0,r.kt)("p",null,"The type system heavily relies on generic properties to provide the most\naccurate development experience. While some may find the overhead a bit\ncumbersome, the tradeoff is worth it! This example will dive into implementing\ngeneric types for route schemas and the dynamic properties located on the\nroute-level ",(0,r.kt)("inlineCode",{parentName:"p"},"request")," object."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If you did not complete the previous example, follow steps 1-4 to get set up.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Inside ",(0,r.kt)("inlineCode",{parentName:"p"},"index.ts"),", define two interfaces ",(0,r.kt)("inlineCode",{parentName:"p"},"IQuerystring")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"IHeaders"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"interface IQuerystring {\n  username: string;\n  password: string;\n}\n\ninterface IHeaders {\n  'h-Custom': string;\n}\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Using the two interfaces, define a new API route and pass them as generics.\nThe shorthand route methods (i.e. ",(0,r.kt)("inlineCode",{parentName:"p"},".get"),") accept a generic object\n",(0,r.kt)("inlineCode",{parentName:"p"},"RouteGenericInterface")," containing five named properties: ",(0,r.kt)("inlineCode",{parentName:"p"},"Body"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"Querystring"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Params"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Headers")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Reply"),". The interfaces ",(0,r.kt)("inlineCode",{parentName:"p"},"Body"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"Querystring"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Params")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Headers")," will be passed down through the route\nmethod into the route method handler ",(0,r.kt)("inlineCode",{parentName:"p"},"request")," instance and the ",(0,r.kt)("inlineCode",{parentName:"p"},"Reply"),"\ninterface to the ",(0,r.kt)("inlineCode",{parentName:"p"},"reply")," instance."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"server.get<{\n  Querystring: IQuerystring,\n  Headers: IHeaders\n}>('/auth', async (request, reply) => {\n  const { username, password } = request.query\n  const customerHeader = request.headers['h-Custom']\n  // do something with request data\n\n  return `logged in!`\n})\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Build and run the server code with ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run build")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run start"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Query the api"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl localhost:8080/auth?username=admin&password=Password123!\n")),(0,r.kt)("p",{parentName:"li"},"And it should return back ",(0,r.kt)("inlineCode",{parentName:"p"},"logged in!"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"But wait theres more! The generic interfaces are also available inside route\nlevel hook methods. Modify the previous route by adding a ",(0,r.kt)("inlineCode",{parentName:"p"},"preValidation"),"\nhook:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"server.get<{\n  Querystring: IQuerystring,\n  Headers: IHeaders\n}>('/auth', {\n  preValidation: (request, reply, done) => {\n    const { username, password } = request.query\n    done(username !== 'admin' ? new Error('Must be admin') : undefined) // only validate `admin` account\n  }\n}, async (request, reply) => {\n  const customerHeader = request.headers['h-Custom']\n  // do something with request data\n  return `logged in!`\n})\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Build and run and query with the ",(0,r.kt)("inlineCode",{parentName:"p"},"username")," query string option set to\nanything other than ",(0,r.kt)("inlineCode",{parentName:"p"},"admin"),". The API should now return a HTTP 500 error\n",(0,r.kt)("inlineCode",{parentName:"p"},'{"statusCode":500,"error":"Internal Server Error","message":"Must be\nadmin"}')))),(0,r.kt)("p",null,"\ud83c\udf89 Good work, now you can define interfaces for each route and have strictly\ntyped request and reply instances. Other parts of the Fastify type system rely\non generic properties. Make sure to reference the detailed type system\ndocumentation below to learn more about what is available."),(0,r.kt)("h3",{id:"json-schema"},"JSON Schema"),(0,r.kt)("p",null,"To validate your requests and responses you can use JSON Schema files. If you\ndidn't know already, defining schemas for your Fastify routes can increase their\nthroughput! Check out the ",(0,r.kt)("a",{parentName:"p",href:"/website-next/docs/v4.0.x/Reference/Validation-and-Serialization"},"Validation and\nSerialization")," documentation for more info."),(0,r.kt)("p",null,"Also it has the advantage to use the defined type within your handlers\n(including pre-validation, etc.)."),(0,r.kt)("p",null,"Here are some options how to achieve this."),(0,r.kt)("h4",{id:"fastify-type-providers"},"Fastify Type Providers"),(0,r.kt)("p",null,"Fastify offers two packages wrapping ",(0,r.kt)("inlineCode",{parentName:"p"},"json-schema-to-ts")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"typebox"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"@fastify/type-provider-json-schema-to-ts")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"@fastify/type-provider-typebox"))),(0,r.kt)("p",null,"They simplify schema validation setup and you can read more about them in ",(0,r.kt)("a",{parentName:"p",href:"/website-next/docs/v4.0.x/Reference/Type-Providers"},"Type\nProviders")," page."),(0,r.kt)("p",null,"Below is how to setup schema validation using vanilla ",(0,r.kt)("inlineCode",{parentName:"p"},"typebox")," and\n",(0,r.kt)("inlineCode",{parentName:"p"},"json-schema-to-ts")," packages."),(0,r.kt)("h4",{id:"typebox"},"typebox"),(0,r.kt)("p",null,"A useful library for building types and a schema at once is\n",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@sinclair/typebox"},"typebox"),". With typebox you\ndefine your schema within your code and use them directly as types or schemas as\nyou need them."),(0,r.kt)("p",null,"When you want to use it for validation of some payload in a fastify route you\ncan do it as follows:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install ",(0,r.kt)("inlineCode",{parentName:"p"},"typebox")," in your project."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i @sinclair/typebox\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Define the schema you need with ",(0,r.kt)("inlineCode",{parentName:"p"},"Type")," and create the respective type  with\n",(0,r.kt)("inlineCode",{parentName:"p"},"Static"),"."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Static, Type } from '@sinclair/typebox'\n\nconst User = Type.Object({\n  name: Type.String(),\n  mail: Type.Optional(Type.String({ format: \"email\" })),\n});\ntype UserType = Static<typeof User>;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Use the defined type and schema during the definition of your route"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'const app = fastify();\n\napp.post<{ Body: UserType; Reply: UserType }>(\n  "/",\n  {\n    schema: {\n      body: User,\n      response: {\n        200: User,\n      },\n    },\n  },\n  (request, reply) => {\n    const { body: user } = request;\n    /* user has type\n    * const user: StaticProperties<{\n    *  name: TString;\n    *  mail: TOptional<TString>;\n    * }>\n    */\n    //...\n    reply.status(200).send(user);\n  }\n);\n')))),(0,r.kt)("h4",{id:"schemas-in-json-files"},"Schemas in JSON Files"),(0,r.kt)("p",null,"In the last example we used interfaces to define the types for the request\nquerystring and headers. Many users will already be using JSON Schemas to define\nthese properties, and luckily there is a way to transform existing JSON Schemas\ninto TypeScript interfaces!"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If you did not complete the 'Getting Started' example, go back and follow\nsteps 1-4 first.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install the ",(0,r.kt)("inlineCode",{parentName:"p"},"json-schema-to-typescript")," module:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i -D json-schema-to-typescript\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a new folder called ",(0,r.kt)("inlineCode",{parentName:"p"},"schemas")," and add two files ",(0,r.kt)("inlineCode",{parentName:"p"},"headers.json")," and\n",(0,r.kt)("inlineCode",{parentName:"p"},"querystring.json"),". Copy and paste the following schema definitions into the\nrespective files:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "title": "Headers Schema",\n  "type": "object",\n  "properties": {\n    "h-Custom": { "type": "string" }\n  },\n  "additionalProperties": false,\n  "required": ["h-Custom"]\n}\n')),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "title": "Querystring Schema",\n  "type": "object",\n  "properties": {\n    "username": { "type": "string" },\n    "password": { "type": "string" }\n  },\n  "additionalProperties": false,\n  "required": ["username", "password"]\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add a ",(0,r.kt)("inlineCode",{parentName:"p"},"compile-schemas")," script to the package.json:"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'   {\n     "scripts": {\n       "compile-schemas": "json2ts -i schemas -o types"\n     }\n   }\n')),(0,r.kt)("p",null,"   ",(0,r.kt)("inlineCode",{parentName:"p"},"json2ts")," is a CLI utility included in ",(0,r.kt)("inlineCode",{parentName:"p"},"json-schema-to-typescript"),". ",(0,r.kt)("inlineCode",{parentName:"p"},"schemas"),"\nis the input path, and ",(0,r.kt)("inlineCode",{parentName:"p"},"types")," is the output path.\n5. Run ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run compile-schemas"),". Two new files should have been created in the\n",(0,r.kt)("inlineCode",{parentName:"p"},"types")," directory.\n6. Update ",(0,r.kt)("inlineCode",{parentName:"p"},"index.ts")," to have the following code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"   import fastify from 'fastify'\n\n   // import json schemas as normal\n   import QuerystringSchema from './schemas/querystring.json'\n   import HeadersSchema from './schemas/headers.json'\n\n   // import the generated interfaces\n   import { QuerystringSchema as QuerystringSchemaInterface } from './types/querystring'\n   import { HeadersSchema as HeadersSchemaInterface } from './types/headers'\n\n   const server = fastify()\n\n   server.get<{\n     Querystring: QuerystringSchemaInterface,\n     Headers: HeadersSchemaInterface\n   }>('/auth', {\n     schema: {\n       querystring: QuerystringSchema,\n       headers: HeadersSchema\n     },\n     preValidation: (request, reply, done) => {\n       const { username, password } = request.query\n       done(username !== 'admin' ? new Error('Must be admin') : undefined)\n     }\n     //  or if using async\n     //  preValidation: async (request, reply) => {\n     //    const { username, password } = request.query\n     //    if (username !== \"admin\") throw new Error(\"Must be admin\");\n     //  }\n   }, async (request, reply) => {\n     const customerHeader = request.headers['h-Custom']\n     // do something with request data\n     return `logged in!`\n   })\n\n   server.route<{\n     Querystring: QuerystringSchemaInterface,\n     Headers: HeadersSchemaInterface\n   }>({\n     method: 'GET',\n     url: '/auth2',\n     schema: {\n       querystring: QuerystringSchema,\n       headers: HeadersSchema\n     },\n     preHandler: (request, reply, done) => {\n       const { username, password } = request.query\n       const customerHeader = request.headers['h-Custom']\n       done()\n     },\n     handler: (request, reply) => {\n       const { username, password } = request.query\n       const customerHeader = request.headers['h-Custom']\n       reply.status(200).send({username});\n     }\n   })\n\n   server.listen({ port: 8080 }, (err, address) => {\n     if (err) {\n       console.error(err)\n       process.exit(0)\n     }\n     console.log(`Server listening at ${address}`)\n   })\n")),(0,r.kt)("p",null,"   Pay special attention to the imports at the top of this file. It might seem\nredundant, but you need to import both the schema files and the generated\ninterfaces."),(0,r.kt)("p",null,"Great work! Now you can make use of both JSON Schemas and TypeScript\ndefinitions."),(0,r.kt)("h4",{id:"json-schema-to-ts"},"json-schema-to-ts"),(0,r.kt)("p",null,"If you do not want to generate types from your schemas, but want to use them\ndiretly from your code, you can use the package\n",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/json-schema-to-ts"},"json-schema-to-ts"),"."),(0,r.kt)("p",null,"You can install it as dev-dependency."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i -D json-schema-to-ts\n")),(0,r.kt)("p",null,"In your code you can define your schema like a normal object. But be aware of\nmaking it ",(0,r.kt)("em",{parentName:"p"},"const")," like explained in the docs of the module."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const todo = {\n  type: 'object',\n  properties: {\n    name: { type: 'string' },\n    description: { type: 'string' },\n    done: { type: 'boolean' },\n  },\n  required: ['name'],\n} as const; // don't forget to use const !\n")),(0,r.kt)("p",null,"With the provided type ",(0,r.kt)("inlineCode",{parentName:"p"},"FromSchema")," you can build a type from your schema and\nuse it in your handler."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { FromSchema } from \"json-schema-to-ts\";\nfastify.post<{ Body: FromSchema<typeof todo> }>(\n  '/todo',\n  {\n    schema: {\n      body: todo,\n      response: {\n        201: {\n          type: 'string',\n        },\n      },\n    }\n  },\n  async (request, reply): Promise<void> => {\n\n    /*\n    request.body has type\n    {\n      [x: string]: unknown;\n      description?: string;\n      done?: boolean;\n      name: string;\n    }\n    */\n\n    request.body.name // will not throw type error\n    request.body.notthere // will throw type error\n\n    reply.status(201).send();\n  },\n);\n")),(0,r.kt)("h3",{id:"plugins"},"Plugins"),(0,r.kt)("p",null,"One of Fastify's most distinguishable features is its extensive plugin\necosystem. Plugin types are fully supported, and take advantage of the\n",(0,r.kt)("a",{parentName:"p",href:"https://www.typescriptlang.org/docs/handbook/declaration-merging.html"},"declaration\nmerging"),"\npattern. This example is broken up into three parts: Creating a TypeScript\nFastify Plugin, Creating Type Definitions for a Fastify Plugin, and Using a\nFastify Plugin in a TypeScript Project."),(0,r.kt)("h4",{id:"creating-a-typescript-fastify-plugin"},"Creating a TypeScript Fastify Plugin"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Initialize a new npm project and install required dependencies"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm init -y\nnpm i fastify fastify-plugin\nnpm i -D typescript @types/node\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add a ",(0,r.kt)("inlineCode",{parentName:"p"},"build")," script to the ",(0,r.kt)("inlineCode",{parentName:"p"},'"scripts"')," section and ",(0,r.kt)("inlineCode",{parentName:"p"},"'index.d.ts'")," to the\n",(0,r.kt)("inlineCode",{parentName:"p"},'"types"')," section of the ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "types": "index.d.ts",\n  "scripts": {\n    "build": "tsc -p tsconfig.json"\n  }\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Initialize a TypeScript configuration file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx typescript --init\n")),(0,r.kt)("p",{parentName:"li"},"Once the file is generated, enable the ",(0,r.kt)("inlineCode",{parentName:"p"},'"declaration"')," option in the\n",(0,r.kt)("inlineCode",{parentName:"p"},'"compilerOptions"')," object."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "compileOptions": {\n    "declaration": true\n  }\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create an ",(0,r.kt)("inlineCode",{parentName:"p"},"index.ts")," file - this will contain the plugin code")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the following code to ",(0,r.kt)("inlineCode",{parentName:"p"},"index.ts")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { FastifyPluginCallback, FastifyPluginAsync } from 'fastify'\nimport fp from 'fastify-plugin'\n\n// using declaration merging, add your plugin props to the appropriate fastify interfaces\n// if prop type is defined here, the value will be typechecked when you call decorate{,Request,Reply}\ndeclare module 'fastify' {\n  interface FastifyRequest {\n    myPluginProp: string\n  }\n  interface FastifyReply {\n    myPluginProp: number\n  }\n}\n\n// define options\nexport interface MyPluginOptions {\n  myPluginOption: string\n}\n\n// define plugin using callbacks\nconst myPluginCallback: FastifyPluginCallback<MyPluginOptions> = (fastify, options, done) => {\n  fastify.decorateRequest('myPluginProp', 'super_secret_value')\n  fastify.decorateReply('myPluginProp', options.myPluginOption)\n\n  done()\n}\n\n// define plugin using promises\nconst myPluginAsync: FastifyPluginAsync<MyPluginOptions> = async (fastify, options) => {\n  fastify.decorateRequest('myPluginProp', 'super_secret_value')\n  fastify.decorateReply('myPluginProp', options.myPluginOption)\n}\n\n// export plugin using fastify-plugin\nexport default fp(myPluginCallback, '3.x')\n// or\n// export default fp(myPluginAsync, '3.x')\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run build")," to compile the plugin code and produce both a JavaScript\nsource file and a type definition file.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"With the plugin now complete you can ","[publish to npm]"," or use it locally."),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"You do not ",(0,r.kt)("em",{parentName:"p"},"need")," to publish your plugin to npm to use it. You can include\nit in a Fastify project and reference it as you would any piece of code! As\na TypeScript user, make sure the declaration override exists somewhere that\nwill be included in your project compilation so the TypeScript interpreter\ncan process it.")))),(0,r.kt)("h4",{id:"creating-type-definitions-for-a-fastify-plugin"},"Creating Type Definitions for a Fastify Plugin"),(0,r.kt)("p",null,"This plugin guide is for Fastify plugins written in JavaScript. The steps\noutlined in this example are for adding TypeScript support for users consuming\nyour plugin."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Initialize a new npm project and install required dependencies"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm init -y\nnpm i fastify-plugin\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create two files ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"index.d.ts"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Modify the package json to include these files under the ",(0,r.kt)("inlineCode",{parentName:"p"},"main")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"types"),"\nproperties (the name does not have to be ",(0,r.kt)("inlineCode",{parentName:"p"},"index")," explicitly, but it is\nrecommended the files have the same name):"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "main": "index.js",\n  "types": "index.d.ts"\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," and add the following code:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// fastify-plugin is highly recommended for any plugin you write\nconst fp = require('fastify-plugin')\n\nfunction myPlugin (instance, options, done) {\n\n  // decorate the fastify instance with a custom function called myPluginFunc\n  instance.decorate('myPluginFunc', (input) => {\n    return input.toUpperCase()\n  })\n\n  done()\n}\n\nmodule.exports = fp(myPlugin, {\n  fastify: '3.x',\n  name: 'my-plugin' // this is used by fastify-plugin to derive the property name\n})\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open ",(0,r.kt)("inlineCode",{parentName:"p"},"index.d.ts")," and add the following code:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { FastifyPlugin } from 'fastify'\n\ninterface PluginOptions {\n  //...\n}\n\n// Optionally, you can add any additional exports.\n// Here we are exporting the decorator we added.\nexport interface myPluginFunc {\n  (input: string): string\n}\n\n// Most importantly, use declaration merging to add the custom property to the Fastify type system\ndeclare module 'fastify' {\n  interface FastifyInstance {\n    myPluginFunc: myPluginFunc\n  }\n}\n\n// fastify-plugin automatically adds named export, so be sure to add also this type\n// the variable name is derived from `options.name` property if `module.exports.myPlugin` is missing\nexport const myPlugin: FastifyPlugin<PluginOptions>\n\n// fastify-plugin automatically adds `.default` property to the exported plugin. See the note below\nexport default myPlugin\n")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note"),": ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify-plugin"},"fastify-plugin")," v2.3.0 and\nnewer, automatically adds ",(0,r.kt)("inlineCode",{parentName:"p"},".default")," property and a named export to the exported\nplugin. Be sure to ",(0,r.kt)("inlineCode",{parentName:"p"},"export default")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"export const myPlugin")," in your typings\nto provide the best developer experience. For a complete example you can check\nout\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify-swagger/blob/master/index.d.ts"},"@fastify/swagger"),"."),(0,r.kt)("p",null,"With those files completed, the plugin is now ready to be consumed by any\nTypeScript project!"),(0,r.kt)("p",null,"The Fastify plugin system enables developers to decorate the Fastify instance,\nand the request/reply instances. For more information check out this blog post\non ",(0,r.kt)("a",{parentName:"p",href:"https://dev.to/ethanarrowood/is-declaration-merging-and-generic-inheritance-at-the-same-time-impossible-53cp"},"Declaration Merging and Generic\nInheritance"),"."),(0,r.kt)("h4",{id:"using-a-plugin"},"Using a Plugin"),(0,r.kt)("p",null,"Using a Fastify plugin in TypeScript is just as easy as using one in JavaScript.\nImport the plugin with ",(0,r.kt)("inlineCode",{parentName:"p"},"import/from")," and you're all set -- except there is one\nexception users should be aware of."),(0,r.kt)("p",null,"Fastify plugins use declaration merging to modify existing Fastify type\ninterfaces (check out the previous two examples for more details). Declaration\nmerging is not very ",(0,r.kt)("em",{parentName:"p"},"smart"),", meaning if the plugin type definition for a plugin\nis within the scope of the TypeScript interpreter, then the plugin types will be\nincluded ",(0,r.kt)("strong",{parentName:"p"},"regardless")," of if the plugin is being used or not. This is an\nunfortunate limitation of using TypeScript and is unavoidable as of right now."),(0,r.kt)("p",null,"However, there are a couple of suggestions to help improve this experience:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Make sure the ",(0,r.kt)("inlineCode",{parentName:"li"},"no-unused-vars")," rule is enabled in\n",(0,r.kt)("a",{parentName:"li",href:"https://eslint.org/docs/rules/no-unused-vars"},"ESLint")," and any imported plugin\nare actually being loaded."),(0,r.kt)("li",{parentName:"ul"},"Use a module such as ",(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/depcheck"},"depcheck")," or\n",(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/npm-check"},"npm-check")," to verify plugin\ndependencies are being used somewhere in your project.")),(0,r.kt)("h2",{id:"code-completion-in-vanilla-javascript"},"Code Completion In Vanilla JavaScript"),(0,r.kt)("p",null,"Vanilla JavaScript can use the published types to provide code completion (e.g.\n",(0,r.kt)("a",{parentName:"p",href:"https://code.visualstudio.com/docs/editor/intellisense"},"Intellisense"),") by\nfollowing the ",(0,r.kt)("a",{parentName:"p",href:"https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html"},"TypeScript JSDoc\nReference"),"."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"/**  @type {import('fastify').FastifyPluginAsync<{ optionA: boolean, optionB: string }>} */\nmodule.exports = async function (fastify, { optionA, optionB }) {\n  fastify.get('/look', () => 'at me');\n}\n")),(0,r.kt)("h2",{id:"api-type-system-documentation"},"API Type System Documentation"),(0,r.kt)("p",null,"This section is a detailed account of all the types available to you in Fastify\nversion 3.x"),(0,r.kt)("p",null,"All ",(0,r.kt)("inlineCode",{parentName:"p"},"http"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"https"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"http2")," types are inferred from ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/node")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"#generics"},"Generics")," are documented by their default value as well as their\nconstraint value(s). Read these articles for more information on TypeScript\ngenerics."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-3.html#generic-parameter-defaults"},"Generic Parameter\nDefault")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.typescriptlang.org/docs/handbook/generics.html#generic-constraints"},"Generic\nConstraints"))),(0,r.kt)("h4",{id:"how-to-import"},"How to import"),(0,r.kt)("p",null,"The Fastify API is powered by the ",(0,r.kt)("inlineCode",{parentName:"p"},"fastify()")," method. In JavaScript you would\nimport it using ",(0,r.kt)("inlineCode",{parentName:"p"},"const fastify = require('fastify')"),". In TypeScript it is\nrecommended to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"import/from")," syntax instead so types can be resolved.\nThere are a couple supported import methods with the Fastify type system."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"import fastify from 'fastify'")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Types are resolved but not accessible using dot notation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Example:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import fastify from 'fastify'\n\nconst f = fastify()\nf.listen({ port: 8080 }, () => { console.log('running') })\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Gain access to types with destructuring:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import fastify, { FastifyInstance } from 'fastify'\n\nconst f: FastifyInstance = fastify()\nf.listen({ port: 8080 }, () => { console.log('running') })\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Destructuring also works for the main API method:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { fastify, FastifyInstance } from 'fastify'\n\nconst f: FastifyInstance = fastify()\nf.listen({ port: 8080 }, () => { console.log('running') })\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"import * as Fastify from 'fastify'")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Types are resolved and accessible using dot notation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Calling the main Fastify API method requires a slightly different syntax\n(see example)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Example:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import * as Fastify from 'fastify'\n\nconst f: Fastify.FastifyInstance = Fastify.fastify()\nf.listen({ port: 8080 }, () => { console.log('running') })\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"const fastify = require('fastify')")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"This syntax is valid and will import fastify as expected; however, types\nwill ",(0,r.kt)("strong",{parentName:"p"},"not")," be resolved")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Example:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const fastify = require('fastify')\n\nconst f = fastify()\nf.listen({ port: 8080 }, () => { console.log('running') })\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Destructuring is supported and will resolve types properly"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const { fastify } = require('fastify')\n\nconst f = fastify()\nf.listen({ port: 8080 }, () => { console.log('running') })\n")))))),(0,r.kt)("h4",{id:"generics"},"Generics"),(0,r.kt)("p",null,"Many type definitions share the same generic parameters; they are all\ndocumented, in detail, within this section."),(0,r.kt)("p",null,"Most definitions depend on ",(0,r.kt)("inlineCode",{parentName:"p"},"@node/types")," modules ",(0,r.kt)("inlineCode",{parentName:"p"},"http"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"https"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"http2")),(0,r.kt)("h5",{id:"rawserver"},"RawServer"),(0,r.kt)("p",null,"Underlying Node.js server type"),(0,r.kt)("p",null,"Default: ",(0,r.kt)("inlineCode",{parentName:"p"},"http.Server")),(0,r.kt)("p",null,"Constraints: ",(0,r.kt)("inlineCode",{parentName:"p"},"http.Server"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"https.Server"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"http2.Http2Server"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"http2.Http2SecureServer")),(0,r.kt)("p",null,"Enforces generic parameters: ",(0,r.kt)("a",{parentName:"p",href:"#rawrequest"},(0,r.kt)("inlineCode",{parentName:"a"},"RawRequest")),",\n",(0,r.kt)("a",{parentName:"p",href:"#rawreply"},(0,r.kt)("inlineCode",{parentName:"a"},"RawReply"))),(0,r.kt)("h5",{id:"rawrequest"},"RawRequest"),(0,r.kt)("p",null,"Underlying Node.js request type"),(0,r.kt)("p",null,"Default: ",(0,r.kt)("a",{parentName:"p",href:"#fastifyrawrequestdefaultexpressionrawserver"},(0,r.kt)("inlineCode",{parentName:"a"},"RawRequestDefaultExpression"))),(0,r.kt)("p",null,"Constraints: ",(0,r.kt)("inlineCode",{parentName:"p"},"http.IncomingMessage"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"http2.Http2ServerRequest")),(0,r.kt)("p",null,"Enforced by: ",(0,r.kt)("a",{parentName:"p",href:"#rawserver"},(0,r.kt)("inlineCode",{parentName:"a"},"RawServer"))),(0,r.kt)("h5",{id:"rawreply"},"RawReply"),(0,r.kt)("p",null,"Underlying Node.js response type"),(0,r.kt)("p",null,"Default: ",(0,r.kt)("a",{parentName:"p",href:"#fastifyrawreplydefaultexpression"},(0,r.kt)("inlineCode",{parentName:"a"},"RawReplyDefaultExpression"))),(0,r.kt)("p",null,"Constraints: ",(0,r.kt)("inlineCode",{parentName:"p"},"http.ServerResponse"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"http2.Http2ServerResponse")),(0,r.kt)("p",null,"Enforced by: ",(0,r.kt)("a",{parentName:"p",href:"#rawserver"},(0,r.kt)("inlineCode",{parentName:"a"},"RawServer"))),(0,r.kt)("h5",{id:"logger"},"Logger"),(0,r.kt)("p",null,"Fastify logging utility"),(0,r.kt)("p",null,"Default: ",(0,r.kt)("a",{parentName:"p",href:"#fastifyfastifyloggeroptions"},(0,r.kt)("inlineCode",{parentName:"a"},"FastifyLoggerOptions"))),(0,r.kt)("p",null,"Enforced by: ",(0,r.kt)("a",{parentName:"p",href:"#rawserver"},(0,r.kt)("inlineCode",{parentName:"a"},"RawServer"))),(0,r.kt)("h5",{id:"rawbody"},"RawBody"),(0,r.kt)("p",null,"A generic parameter for the content-type-parser methods."),(0,r.kt)("p",null,"Constraints: ",(0,r.kt)("inlineCode",{parentName:"p"},"string | Buffer")),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"fastify"},"Fastify"),(0,r.kt)("h5",{id:"fastifyrawserver-rawrequest-rawreply-loggeropts-fastifyserveroptions-fastifyinstance"},"fastify<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#logger"},"Logger"),">(opts?: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyserveroptions-rawserver-logger"},"FastifyServerOptions"),"): ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyinstance"},"FastifyInstance")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/fastify.d.ts#L19"},"src")),(0,r.kt)("p",null,"The main Fastify API method. By default creates an HTTP server. Utilizing\ndiscriminant unions and overload methods, the type system will automatically\ninfer which type of server (http, https, or http2) is being created purely based\non the options based to the method (see the examples below for more\ninformation). It also supports an extensive generic type system to allow the\nuser to extend the underlying Node.js Server, Request, and Reply objects.\nAdditionally, the ",(0,r.kt)("inlineCode",{parentName:"p"},"Logger")," generic exists for custom log types. See the examples\nand generic breakdown below for more information."),(0,r.kt)("h6",{id:"example-1-standard-http-server"},"Example 1: Standard HTTP server"),(0,r.kt)("p",null,"No need to specify the ",(0,r.kt)("inlineCode",{parentName:"p"},"Server")," generic as the type system defaults to HTTP."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import fastify from 'fastify'\n\nconst server = fastify()\n")),(0,r.kt)("p",null,"Check out the Learn By Example - ",(0,r.kt)("a",{parentName:"p",href:"#getting-started"},"Getting Started")," example for\na more detailed http server walkthrough."),(0,r.kt)("h6",{id:"example-2-https-sever"},"Example 2: HTTPS sever"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create the following imports from ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/node")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"fastify")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import fs from 'fs'\nimport path from 'path'\nimport fastify from 'fastify'\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Follow the steps in this official ",(0,r.kt)("a",{parentName:"p",href:"https://nodejs.org/en/knowledge/HTTP/servers/how-to-create-a-HTTPS-server/"},"Node.js https server\nguide"),"\nto create the ",(0,r.kt)("inlineCode",{parentName:"p"},"key.pem")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"cert.pem")," files")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Instantiate a Fastify https server and add a route:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const server = fastify({\n  https: {\n    key: fs.readFileSync(path.join(__dirname, 'key.pem')),\n    cert: fs.readFileSync(path.join(__dirname, 'cert.pem'))\n  }\n})\n\nserver.get('/', async function (request, reply) {\n  return { hello: 'world' }\n})\n\nserver.listen({ port: 8080 }, (err, address) => {\n  if (err) {\n    console.error(err)\n    process.exit(0)\n  }\n  console.log(`Server listening at ${address}`)\n})\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Build and run! Test your server out by querying with: ",(0,r.kt)("inlineCode",{parentName:"p"},"curl -k\nhttps://localhost:8080")))),(0,r.kt)("h6",{id:"example-3-http2-server"},"Example 3: HTTP2 server"),(0,r.kt)("p",null,"There are two types of HTTP2 server types, insecure and secure. Both require\nspecifying the ",(0,r.kt)("inlineCode",{parentName:"p"},"http2")," property as ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," object. The ",(0,r.kt)("inlineCode",{parentName:"p"},"https"),"\nproperty is used for creating a secure http2 server; omitting the ",(0,r.kt)("inlineCode",{parentName:"p"},"https"),"\nproperty will create an insecure http2 server."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const insecureServer = fastify({ http2: true })\nconst secureServer = fastify({\n  http2: true,\n  https: {} // use the `key.pem` and `cert.pem` files from the https section\n})\n")),(0,r.kt)("p",null,"For more details on using HTTP2 check out the Fastify ",(0,r.kt)("a",{parentName:"p",href:"/website-next/docs/v4.0.x/Reference/HTTP2"},"HTTP2"),"\ndocumentation page."),(0,r.kt)("h6",{id:"example-4-extended-http-server"},"Example 4: Extended HTTP server"),(0,r.kt)("p",null,"Not only can you specify the server type, but also the request and reply types.\nThus, allowing you to specify special properties, methods, and more! When\nspecified at server instantiation, the custom type becomes available on all\nfurther instances of the custom type."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import fastify from 'fastify'\nimport http from 'http'\n\ninterface customRequest extends http.IncomingMessage {\n  mySpecialProp: string\n}\n\nconst server = fastify<http.Server, customRequest>()\n\nserver.get('/', async (request, reply) => {\n  const someValue = request.raw.mySpecialProp // TS knows this is a string, because of the `customRequest` interface\n  return someValue.toUpperCase()\n})\n")),(0,r.kt)("h6",{id:"example-5-specifying-logger-types"},"Example 5: Specifying logger types"),(0,r.kt)("p",null,"Fastify uses ",(0,r.kt)("a",{parentName:"p",href:"https://getpino.io/#/"},"Pino")," logging library under the hood. Since\n",(0,r.kt)("inlineCode",{parentName:"p"},"pino@7"),", all of it's properties can be configured via ",(0,r.kt)("inlineCode",{parentName:"p"},"logger")," field when\nconstructing Fastify's instance. If properties you need aren't exposed, please\nopen an Issue to ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/pinojs/pino/issues"},(0,r.kt)("inlineCode",{parentName:"a"},"Pino"))," or pass a\npreconfigured external instance of Pino (or any other compatible logger) as\ntemporary fix to Fastify via the same field. This allows creating custom\nserializers as well, see the ",(0,r.kt)("a",{parentName:"p",href:"/website-next/docs/v4.0.x/Reference/Logging"},"Logging")," documentation for more info."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import fastify from 'fastify'\n\nconst server = fastify({\n  logger: {\n    level: 'info',\n    redact: ['x-userinfo'],\n    messageKey: 'message'\n  }\n})\n\nserver.get('/', async (request, reply) => {\n  server.log.info('log message')\n  return 'another message'\n})\n")),(0,r.kt)("hr",null),(0,r.kt)("h5",{id:"fastifyhttpmethods"},"fastify.HTTPMethods"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/utils.d.ts#L8"},"src")),(0,r.kt)("p",null,"Union type of: ",(0,r.kt)("inlineCode",{parentName:"p"},"'DELETE' | 'GET' | 'HEAD' | 'PATCH' | 'POST' | 'PUT' |\n'OPTIONS'")),(0,r.kt)("h5",{id:"fastifyrawserverbase"},"fastify.RawServerBase"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/utils.d.ts#L13"},"src")),(0,r.kt)("p",null,"Dependant on ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/node")," modules ",(0,r.kt)("inlineCode",{parentName:"p"},"http"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"https"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"http2")),(0,r.kt)("p",null,"Union type of: ",(0,r.kt)("inlineCode",{parentName:"p"},"http.Server | https.Server | http2.Http2Server |\nhttp2.Http2SecureServer")),(0,r.kt)("h5",{id:"fastifyrawserverdefault"},"fastify.RawServerDefault"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/utils.d.ts#L18"},"src")),(0,r.kt)("p",null,"Dependant on ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/node")," modules ",(0,r.kt)("inlineCode",{parentName:"p"},"http")),(0,r.kt)("p",null,"Type alias for ",(0,r.kt)("inlineCode",{parentName:"p"},"http.Server")),(0,r.kt)("hr",null),(0,r.kt)("h5",{id:"fastifyfastifyserveroptionsrawserver-logger"},"fastify.FastifyServerOptions<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#logger"},"Logger"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/fastify.d.ts#L29"},"src")),(0,r.kt)("p",null,"An interface of properties used in the instantiation of the Fastify server. Is\nused in the main ",(0,r.kt)("a",{parentName:"p",href:"#fastifyrawserver-rawrequest-rawreply-loggeropts-fastifyserveroptions-fastifyinstance"},(0,r.kt)("inlineCode",{parentName:"a"},"fastify()"))," method. The ",(0,r.kt)("inlineCode",{parentName:"p"},"RawServer")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Logger"),"\ngeneric parameters are passed down through that method."),(0,r.kt)("p",null,"See the main ",(0,r.kt)("a",{parentName:"p",href:"#fastifyrawserver-rawrequest-rawreply-loggeropts-fastifyserveroptions-fastifyinstance"},"fastify")," method type definition section for examples on\ninstantiating a Fastify server with TypeScript."),(0,r.kt)("h5",{id:"fastifyfastifyinstancerawserver-rawrequest-requestgeneric-logger"},"fastify.FastifyInstance<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#logger"},"Logger"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/instance.d.ts#L16"},"src")),(0,r.kt)("p",null,"Interface that represents the Fastify server object. This is the returned server\ninstance from the ",(0,r.kt)("a",{parentName:"p",href:"#fastifyrawserver-rawrequest-rawreply-loggeropts-fastifyserveroptions-fastifyinstance"},(0,r.kt)("inlineCode",{parentName:"a"},"fastify()"))," method. This type is an interface so it\ncan be extended via ",(0,r.kt)("a",{parentName:"p",href:"https://www.typescriptlang.org/docs/handbook/declaration-merging.html"},"declaration\nmerging"),"\nif your code makes use of the ",(0,r.kt)("inlineCode",{parentName:"p"},"decorate")," method."),(0,r.kt)("p",null,"Through the use of generic cascading, all methods attached to the instance\ninherit the generic properties from instantiation. This means that by specifying\nthe server, request, or reply types, all methods will know how to type those\nobjects."),(0,r.kt)("p",null,"Check out the main ",(0,r.kt)("a",{parentName:"p",href:"#learn-by-example"},"Learn by Example")," section for detailed\nguides, or the more simplified ",(0,r.kt)("a",{parentName:"p",href:"#fastifyrawserver-rawrequest-rawreply-loggeropts-fastifyserveroptions-fastifyinstance"},"fastify")," method examples for additional\ndetails on this interface."),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"request"},"Request"),(0,r.kt)("h5",{id:"fastifyfastifyrequestrequestgeneric-rawserver-rawrequest"},"fastify.FastifyRequest<",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/request.d.ts#L15"},"src")),(0,r.kt)("p",null,"This interface contains properties of Fastify request object. The properties\nadded here disregard what kind of request object (http vs http2) and disregard\nwhat route level it is serving; thus calling ",(0,r.kt)("inlineCode",{parentName:"p"},"request.body")," inside a GET request\nwill not throw an error (but good luck sending a GET request with a body \ud83d\ude09)."),(0,r.kt)("p",null,"If you need to add custom properties to the ",(0,r.kt)("inlineCode",{parentName:"p"},"FastifyRequest")," object (such as\nwhen using the ","[",(0,r.kt)("inlineCode",{parentName:"p"},"decorateRequest"),"][DecorateRequest]"," method) you need to use\ndeclaration merging on this interface."),(0,r.kt)("p",null,"A basic example is provided in the ",(0,r.kt)("a",{parentName:"p",href:"#fastifyfastifyrequestrawserver-rawrequest-requestgeneric"},(0,r.kt)("inlineCode",{parentName:"a"},"FastifyRequest"))," section.\nFor a more detailed example check out the Learn By Example section:\n",(0,r.kt)("a",{parentName:"p",href:"#plugins"},"Plugins")),(0,r.kt)("h6",{id:"example"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import fastify from 'fastify'\n\nconst server = fastify()\n\nserver.decorateRequest('someProp', 'hello!')\n\nserver.get('/', async (request, reply) => {\n  const { someProp } = request // need to use declaration merging to add this prop to the request interface\n  return someProp\n})\n\n// this declaration must be in scope of the typescript interpreter to work\ndeclare module 'fastify' {\n  interface FastifyRequest { // you must reference the interface and not the type\n    someProp: string\n  }\n}\n\n// Or you can type your request using\ntype CustomRequest = FastifyRequest<{\n  Body: { test: boolean };\n}>\n\nserver.get('/typedRequest', async (request: CustomRequest, reply: FastifyReply) => {\n  return request.body.test\n})\n")),(0,r.kt)("h5",{id:"fastifyrequestgenericinterface"},"fastify.RequestGenericInterface"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/request.d.ts#L4"},"src")),(0,r.kt)("p",null,"Fastify request objects have four dynamic properties: ",(0,r.kt)("inlineCode",{parentName:"p"},"body"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"params"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"query"),",\nand ",(0,r.kt)("inlineCode",{parentName:"p"},"headers"),". Their respective types are assignable through this interface. It\nis a named property interface enabling the developer to ignore the properties\nthey do not want to specify. All omitted properties are defaulted to ",(0,r.kt)("inlineCode",{parentName:"p"},"unknown"),".\nThe corresponding property names are: ",(0,r.kt)("inlineCode",{parentName:"p"},"Body"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Querystring"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Params"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"Headers"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import fastify, { RequestGenericInterface } from 'fastify'\n\nconst server = fastify()\n\ninterface requestGeneric extends RequestGenericInterface {\n  Querystring: {\n    name: string\n  }\n}\n\nserver.get<requestGeneric>('/', async (request, reply) => {\n  const { name } = request.query // the name prop now exists on the query prop\n  return name.toUpperCase()\n})\n")),(0,r.kt)("p",null,"If you want to see a detailed example of using this interface check out the\nLearn by Example section: ",(0,r.kt)("a",{parentName:"p",href:"#jsonschema"},"JSON Schema"),"."),(0,r.kt)("h5",{id:"fastifyrawrequestdefaultexpressionrawserver"},"fastify.RawRequestDefaultExpression\\<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/utils.d.ts#L23"},"src")),(0,r.kt)("p",null,"Dependant on ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/node")," modules ",(0,r.kt)("inlineCode",{parentName:"p"},"http"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"https"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"http2")),(0,r.kt)("p",null,"Generic parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"RawServer")," defaults to ",(0,r.kt)("a",{parentName:"p",href:"#fastifyrawserverdefault"},(0,r.kt)("inlineCode",{parentName:"a"},"RawServerDefault"))),(0,r.kt)("p",null,"If ",(0,r.kt)("inlineCode",{parentName:"p"},"RawServer")," is of type ",(0,r.kt)("inlineCode",{parentName:"p"},"http.Server")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"https.Server"),", then this expression\nreturns ",(0,r.kt)("inlineCode",{parentName:"p"},"http.IncomingMessage"),", otherwise, it returns\n",(0,r.kt)("inlineCode",{parentName:"p"},"http2.Http2ServerRequest"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import http from 'http'\nimport http2 from 'http2'\nimport { RawRequestDefaultExpression } from 'fastify'\n\nRawRequestDefaultExpression<http.Server> // -> http.IncomingMessage\nRawRequestDefaultExpression<http2.Http2Server> // -> http2.Http2ServerRequest\n")),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"reply"},"Reply"),(0,r.kt)("h5",{id:"fastifyfastifyreplyrawserver-rawrequest-rawreply-requestgeneric-contextconfig"},"fastify.FastifyReply<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/reply.d.ts#L32"},"src")),(0,r.kt)("p",null,"This interface contains the custom properties that Fastify adds to the standard\nNode.js reply object. The properties added here disregard what kind of reply\nobject (http vs http2)."),(0,r.kt)("p",null,"If you need to add custom properties to the FastifyReply object (such as when\nusing the ",(0,r.kt)("inlineCode",{parentName:"p"},"decorateReply")," method) you need to use declaration merging on this\ninterface."),(0,r.kt)("p",null,"A basic example is provided in the ",(0,r.kt)("a",{parentName:"p",href:"#fastifyfastifyreplyrawserver-rawreply-contextconfig"},(0,r.kt)("inlineCode",{parentName:"a"},"FastifyReply"))," section. For a\nmore detailed example check out the Learn By Example section:\n",(0,r.kt)("a",{parentName:"p",href:"#plugins"},"Plugins")),(0,r.kt)("h6",{id:"example-1"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import fastify from 'fastify'\n\nconst server = fastify()\n\nserver.decorateReply('someProp', 'world')\n\nserver.get('/', async (request, reply) => {\n  const { someProp } = reply // need to use declaration merging to add this prop to the reply interface\n  return someProp\n})\n\n// this declaration must be in scope of the typescript interpreter to work\ndeclare module 'fastify' {\n  interface FastifyReply { // you must reference the interface and not the type\n    someProp: string\n  }\n}\n")),(0,r.kt)("h5",{id:"fastifyrawreplydefaultexpressionrawserver"},"fastify.RawReplyDefaultExpression<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/utils.d.ts#L27"},"src")),(0,r.kt)("p",null,"Dependant on ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/node")," modules ",(0,r.kt)("inlineCode",{parentName:"p"},"http"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"https"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"http2")),(0,r.kt)("p",null,"Generic parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"RawServer")," defaults to ",(0,r.kt)("a",{parentName:"p",href:"#fastifyrawserverdefault"},(0,r.kt)("inlineCode",{parentName:"a"},"RawServerDefault"))),(0,r.kt)("p",null,"If ",(0,r.kt)("inlineCode",{parentName:"p"},"RawServer")," is of type ",(0,r.kt)("inlineCode",{parentName:"p"},"http.Server")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"https.Server"),", then this expression\nreturns ",(0,r.kt)("inlineCode",{parentName:"p"},"http.ServerResponse"),", otherwise, it returns\n",(0,r.kt)("inlineCode",{parentName:"p"},"http2.Http2ServerResponse"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import http from 'http'\nimport http2 from 'http2'\nimport { RawReplyDefaultExpression } from 'fastify'\n\nRawReplyDefaultExpression<http.Server> // -> http.ServerResponse\nRawReplyDefaultExpression<http2.Http2Server> // -> http2.Http2ServerResponse\n")),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"plugin"},"Plugin"),(0,r.kt)("p",null,"Fastify allows the user to extend its functionalities with plugins. A plugin can\nbe a set of routes, a server decorator or whatever. To activate plugins, use the\n",(0,r.kt)("a",{parentName:"p",href:"#fastifyfastifyregisterrawserver-rawrequest-requestgenericplugin-fastifyplugin-opts-fastifyregisteroptions"},(0,r.kt)("inlineCode",{parentName:"a"},"fastify.register()"))," method."),(0,r.kt)("p",null,"When creating plugins for Fastify, it is recommended to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"fastify-plugin"),"\nmodule. Additionally, there is a guide to creating plugins with TypeScript and\nFastify available in the Learn by Example, ",(0,r.kt)("a",{parentName:"p",href:"#plugins"},"Plugins")," section."),(0,r.kt)("h5",{id:"fastifyfastifyplugincallbackoptions"},"fastify.FastifyPluginCallback<",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifypluginoptions"},"Options"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/plugin.d.ts#L9"},"src")),(0,r.kt)("p",null,"Interface method definition used within the\n",(0,r.kt)("a",{parentName:"p",href:"#fastifyfastifyregisterrawserver-rawrequest-requestgenericplugin-fastifyplugin-opts-fastifyregisteroptions"},(0,r.kt)("inlineCode",{parentName:"a"},"fastify.register()"))," method."),(0,r.kt)("h5",{id:"fastifyfastifypluginasyncoptions"},"fastify.FastifyPluginAsync<",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifypluginoptions"},"Options"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/plugin.d.ts#L20"},"src")),(0,r.kt)("p",null,"Interface method definition used within the\n",(0,r.kt)("a",{parentName:"p",href:"#fastifyfastifyregisterrawserver-rawrequest-requestgenericplugin-fastifyplugin-opts-fastifyregisteroptions"},(0,r.kt)("inlineCode",{parentName:"a"},"fastify.register()"))," method."),(0,r.kt)("h5",{id:"fastifyfastifypluginoptions"},"fastify.FastifyPlugin<",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifypluginoptions"},"Options"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/plugin.d.ts#L29"},"src")),(0,r.kt)("p",null,"Interface method definition used within the\n",(0,r.kt)("a",{parentName:"p",href:"#fastifyfastifyregisterrawserver-rawrequest-requestgenericplugin-fastifyplugin-opts-fastifyregisteroptions"},(0,r.kt)("inlineCode",{parentName:"a"},"fastify.register()"))," method. Document deprecated in favor of\n",(0,r.kt)("inlineCode",{parentName:"p"},"FastifyPluginCallback")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"FastifyPluginAsync")," since general ",(0,r.kt)("inlineCode",{parentName:"p"},"FastifyPlugin"),"\ndoesn't properly infer types for async functions."),(0,r.kt)("h5",{id:"fastifyfastifypluginoptions-1"},"fastify.FastifyPluginOptions"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/plugin.d.ts#L31"},"src")),(0,r.kt)("p",null,"A loosely typed object used to constrain the ",(0,r.kt)("inlineCode",{parentName:"p"},"options")," parameter of\n",(0,r.kt)("a",{parentName:"p",href:"#fastifyfastifyregisterrawserver-rawrequest-requestgenericplugin-fastifyplugin-opts-fastifyregisteroptions"},(0,r.kt)("inlineCode",{parentName:"a"},"fastify.register()"))," to an object. When creating a plugin,\ndefine its options as an extension of this interface (",(0,r.kt)("inlineCode",{parentName:"p"},"interface MyPluginOptions\nextends FastifyPluginOptions"),") so they can be passed to the register method."),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"register"},"Register"),(0,r.kt)("h5",{id:"fastifyfastifyregisterplugin-fastifyplugincallback-opts-fastifyregisteroptions"},"fastify.FastifyRegister(plugin: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyplugincallbackoptions"},"FastifyPluginCallback"),", opts: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifytregisteroptions"},"FastifyRegisterOptions"),")"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/register.d.ts#L9"},"src")),(0,r.kt)("h5",{id:"fastifyfastifyregisterplugin-fastifypluginasync-opts-fastifyregisteroptions"},"fastify.FastifyRegister(plugin: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifypluginasyncoptions"},"FastifyPluginAsync"),", opts: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifytregisteroptions"},"FastifyRegisterOptions"),")"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/register.d.ts#L9"},"src")),(0,r.kt)("h5",{id:"fastifyfastifyregisterplugin-fastifyplugin-opts-fastifyregisteroptions"},"fastify.FastifyRegister(plugin: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifypluginoptions-rawserver-rawrequest-requestgeneric"},"FastifyPlugin"),", opts: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifytregisteroptions"},"FastifyRegisterOptions"),")"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/register.d.ts#L9"},"src")),(0,r.kt)("p",null,"This type interface specifies the type for the\n",(0,r.kt)("a",{parentName:"p",href:"/website-next/docs/v4.0.x/Reference/Server#register"},(0,r.kt)("inlineCode",{parentName:"a"},"fastify.register()"))," method. The type interface returns\na function signature with an underlying generic ",(0,r.kt)("inlineCode",{parentName:"p"},"Options")," which is defaulted to\n",(0,r.kt)("a",{parentName:"p",href:"#fastifyfastifypluginoptions"},"FastifyPluginOptions"),". It infers this generic from the\nFastifyPlugin parameter when calling this function so there is no need to\nspecify the underlying generic. The options parameter is the intersection of the\nplugin's options and two additional optional properties: ",(0,r.kt)("inlineCode",{parentName:"p"},"prefix: string")," and\n",(0,r.kt)("inlineCode",{parentName:"p"},"logLevel"),": ",(0,r.kt)("a",{parentName:"p",href:"#fastifyloglevel"},"LogLevel"),"."),(0,r.kt)("p",null,"Below is an example of the options inference in action:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const server = fastify()\n\nconst plugin: FastifyPlugin<{\n  option1: string;\n  option2: boolean;\n}> = function (instance, opts, done) { }\n\nfastify().register(plugin, {}) // Error - options object is missing required properties\nfastify().register(plugin, { option1: '', option2: true }) // OK - options object contains required properties\n")),(0,r.kt)("p",null,"See the Learn By Example, ",(0,r.kt)("a",{parentName:"p",href:"#plugins"},"Plugins")," section for more detailed examples\nof creating TypeScript plugins in Fastify."),(0,r.kt)("h5",{id:"fastifyfastifyregisteroptions"},"fastify.FastifyRegisterOptions"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/register.d.ts#L16"},"src")),(0,r.kt)("p",null,"This type is the intersection of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Options")," generic and a non-exported\ninterface ",(0,r.kt)("inlineCode",{parentName:"p"},"RegisterOptions")," that specifies two optional properties: ",(0,r.kt)("inlineCode",{parentName:"p"},"prefix:\nstring")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"logLevel"),": ",(0,r.kt)("a",{parentName:"p",href:"#fastifyloglevel"},"LogLevel"),". This type can also be specified as\na function that returns the previously described intersection."),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"logger-1"},"Logger"),(0,r.kt)("p",null,"Check out the ",(0,r.kt)("a",{parentName:"p",href:"#example-5-specifying-logger-types"},"Specifying Logger Types"),"\nexample for more details on specifying a custom logger."),(0,r.kt)("h5",{id:"fastifyfastifyloggeroptionsrawserver-rawrequest-rawreply"},"fastify.FastifyLoggerOptions<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/logger.d.ts#L17"},"src")),(0,r.kt)("p",null,"An interface definition for the internal Fastify logger. It is emulative of the\n",(0,r.kt)("a",{parentName:"p",href:"https://getpino.io/#/"},"Pino.js")," logger. When enabled through server options,\nuse it following the general ",(0,r.kt)("a",{parentName:"p",href:"/website-next/docs/v4.0.x/Reference/Logging"},"logger")," documentation."),(0,r.kt)("h5",{id:"fastifyfastifylogfn"},"fastify.FastifyLogFn"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/logger.d.ts#L7"},"src")),(0,r.kt)("p",null,"An overload function interface that implements the two ways Fastify calls log\nmethods. This interface is passed to all associated log level properties on the\nFastifyLoggerOptions object."),(0,r.kt)("h5",{id:"fastifyloglevel"},"fastify.LogLevel"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/logger.d.ts#L12"},"src")),(0,r.kt)("p",null,"Union type of: ",(0,r.kt)("inlineCode",{parentName:"p"},"'info' | 'error' | 'debug' | 'fatal' | 'warn' | 'trace'")),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"context"},"Context"),(0,r.kt)("p",null,"The context type definition is similar to the other highly dynamic pieces of the\ntype system. Route context is available in the route handler method."),(0,r.kt)("h5",{id:"fastifyfastifycontext"},"fastify.FastifyContext"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/context.d.ts#L6"},"src")),(0,r.kt)("p",null,"An interface with a single required property ",(0,r.kt)("inlineCode",{parentName:"p"},"config")," that is set by default to\n",(0,r.kt)("inlineCode",{parentName:"p"},"unknown"),". Can be specified either using a generic or an overload."),(0,r.kt)("p",null,"This type definition is potentially incomplete. If you are using it and can\nprovide more details on how to improve the definition, we strongly encourage you\nto open an issue in the main\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify"},"fastify/fastify")," repository. Thank you in\nadvanced!"),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"routing"},"Routing"),(0,r.kt)("p",null,"One of the core principles in Fastify is its routing capabilities. Most of the\ntypes defined in this section are used under-the-hood by the Fastify instance\n",(0,r.kt)("inlineCode",{parentName:"p"},".route")," and ",(0,r.kt)("inlineCode",{parentName:"p"},".get/.post/.etc")," methods."),(0,r.kt)("h5",{id:"fastifyroutehandlermethodrawserver-rawrequest-rawreply-requestgeneric-contextconfig"},"fastify.RouteHandlerMethod<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/route.d.ts#L105"},"src")),(0,r.kt)("p",null,"A type declaration for the route handler methods. Has two arguments, ",(0,r.kt)("inlineCode",{parentName:"p"},"request"),"\nand ",(0,r.kt)("inlineCode",{parentName:"p"},"reply")," which are typed by ",(0,r.kt)("inlineCode",{parentName:"p"},"FastifyRequest")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"FastifyReply")," respectfully.\nThe generics parameters are passed through to these arguments. The method\nreturns either ",(0,r.kt)("inlineCode",{parentName:"p"},"void")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise<any>")," for synchronous and asynchronous\nhandlers respectfully."),(0,r.kt)("h5",{id:"fastifyrouteoptionsrawserver-rawrequest-rawreply-requestgeneric-contextconfig"},"fastify.RouteOptions<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/route.d.ts#L78"},"src")),(0,r.kt)("p",null,"An interface that extends RouteShorthandOptions and adds the following three\nrequired properties:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"method")," which corresponds to a singular ",(0,r.kt)("a",{parentName:"li",href:"#fastifyhttpmethods"},"HTTPMethod")," or a list\nof ",(0,r.kt)("a",{parentName:"li",href:"#fastifyhttpmethods"},"HTTPMethods")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"url")," a string for the route"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"handler")," the route handler method, see ","[RouteHandlerMethod][]"," for more\ndetails")),(0,r.kt)("h5",{id:"fastifyrouteshorthandmethodrawserver-rawrequest-rawreply"},"fastify.RouteShorthandMethod<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/route.d.ts#12"},"src")),(0,r.kt)("p",null,"An overloaded function interface for three kinds of shorthand route methods to\nbe used in conjunction with the ",(0,r.kt)("inlineCode",{parentName:"p"},".get/.post/.etc")," methods."),(0,r.kt)("h5",{id:"fastifyrouteshorthandoptionsrawserver-rawrequest-rawreply-requestgeneric-contextconfig"},"fastify.RouteShorthandOptions<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/route.d.ts#55"},"src")),(0,r.kt)("p",null,"An interface that covers all of the base options for a route. Each property on\nthis interface is optional, and it serves as the base for the RouteOptions and\nRouteShorthandOptionsWithHandler interfaces."),(0,r.kt)("h5",{id:"fastifyrouteshorthandoptionswithhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfig"},"fastify.RouteShorthandOptionsWithHandler<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/route.d.ts#93"},"src")),(0,r.kt)("p",null,"This interface adds a single, required property to the RouteShorthandOptions\ninterface ",(0,r.kt)("inlineCode",{parentName:"p"},"handler")," which is of type RouteHandlerMethod"),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"parsers"},"Parsers"),(0,r.kt)("h5",{id:"rawbody-1"},"RawBody"),(0,r.kt)("p",null,"A generic type that is either a ",(0,r.kt)("inlineCode",{parentName:"p"},"string")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"Buffer")),(0,r.kt)("h5",{id:"fastifyfastifybodyparserrawbody-rawserver-rawrequest"},"fastify.FastifyBodyParser<",(0,r.kt)("a",{parentName:"h5",href:"#rawbody"},"RawBody"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/content-type-parser.d.ts#L7"},"src")),(0,r.kt)("p",null,"A function type definition for specifying a body parser method. Use the\n",(0,r.kt)("inlineCode",{parentName:"p"},"RawBody")," generic to specify the type of the body being parsed."),(0,r.kt)("h5",{id:"fastifyfastifycontenttypeparserrawserver-rawrequest"},"fastify.FastifyContentTypeParser<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/content-type-parser.d.ts#L17"},"src")),(0,r.kt)("p",null,"A function type definition for specifying a body parser method. Content is typed\nvia the ",(0,r.kt)("inlineCode",{parentName:"p"},"RawRequest")," generic."),(0,r.kt)("h5",{id:"fastifyaddcontenttypeparserrawserver-rawrequest"},"fastify.AddContentTypeParser<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),">"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/content-type-parser.d.ts#L46"},"src")),(0,r.kt)("p",null,"An overloaded interface function definition for the ",(0,r.kt)("inlineCode",{parentName:"p"},"addContentTypeParser"),"\nmethod. If ",(0,r.kt)("inlineCode",{parentName:"p"},"parseAs")," is passed to the ",(0,r.kt)("inlineCode",{parentName:"p"},"opts")," parameter, the definition uses\n","[FastifyBodyParser][]"," for the ",(0,r.kt)("inlineCode",{parentName:"p"},"parser")," parameter; otherwise, it uses\n","[FastifyContentTypeParser][]","."),(0,r.kt)("h5",{id:"fastifyhascontenttypeparser"},"fastify.hasContentTypeParser"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/content-type-parser.d.ts#L63"},"src")),(0,r.kt)("p",null,"A method for checking the existence of a type parser of a certain content type"),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"errors"},"Errors"),(0,r.kt)("h5",{id:"fastifyfastifyerror"},"fastify.FastifyError"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/error.d.ts#L17"},"src")),(0,r.kt)("p",null,"FastifyError is a custom error object that includes status code and validation\nresults."),(0,r.kt)("p",null,"It extends the Node.js ",(0,r.kt)("inlineCode",{parentName:"p"},"Error")," type, and adds two additional, optional\nproperties: ",(0,r.kt)("inlineCode",{parentName:"p"},"statusCode: number")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"validation: ValiationResult[]"),"."),(0,r.kt)("h5",{id:"fastifyvalidationresult"},"fastify.ValidationResult"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/error.d.ts#L4"},"src")),(0,r.kt)("p",null,"The route validation internally relies upon Ajv, which is a high-performance\nJSON schema validator."),(0,r.kt)("p",null,"This interface is passed to instance of FastifyError."),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"hooks"},"Hooks"),(0,r.kt)("h5",{id:"fastifyonrequesthookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-done-err-fastifyerror--void-promiseunknown--void"},"fastify.onRequestHookHandler<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">(request: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyrequestrawserver-rawrequest-requestgeneric"},"FastifyRequest"),", reply: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyreplyrawserver-rawreply-contextconfig"},"FastifyReply"),", done: (err?: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyerror"},"FastifyError"),") => void): Promise\\<unknown",">"," | void"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/hooks.d.ts#L17"},"src")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"onRequest")," is the first hook to be executed in the request lifecycle. There was\nno previous hook, the next hook will be ",(0,r.kt)("inlineCode",{parentName:"p"},"preParsing"),"."),(0,r.kt)("p",null,"Notice: in the ",(0,r.kt)("inlineCode",{parentName:"p"},"onRequest")," hook, request.body will always be null, because the\nbody parsing happens before the ",(0,r.kt)("inlineCode",{parentName:"p"},"preHandler")," hook."),(0,r.kt)("h5",{id:"fastifypreparsinghookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-done-err-fastifyerror--void-promiseunknown--void"},"fastify.preParsingHookHandler<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">(request: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyrequestrawserver-rawrequest-requestgeneric"},"FastifyRequest"),", reply: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyreplyrawserver-rawreply-contextconfig"},"FastifyReply"),", done: (err?: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyerror"},"FastifyError"),") => void): Promise\\<unknown",">"," | void"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/hooks.d.ts#L35"},"src")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"preParsing")," is the second hook to be executed in the request lifecycle. The\nprevious hook was ",(0,r.kt)("inlineCode",{parentName:"p"},"onRequest"),", the next hook will be ",(0,r.kt)("inlineCode",{parentName:"p"},"preValidation"),"."),(0,r.kt)("p",null,"Notice: in the ",(0,r.kt)("inlineCode",{parentName:"p"},"preParsing")," hook, request.body will always be null, because the\nbody parsing happens before the ",(0,r.kt)("inlineCode",{parentName:"p"},"preValidation")," hook."),(0,r.kt)("p",null,"Notice: you should also add ",(0,r.kt)("inlineCode",{parentName:"p"},"receivedEncodedLength")," property to the returned\nstream. This property is used to correctly match the request payload with the\n",(0,r.kt)("inlineCode",{parentName:"p"},"Content-Length")," header value. Ideally, this property should be updated on each\nreceived chunk."),(0,r.kt)("h5",{id:"fastifyprevalidationhookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-done-err-fastifyerror--void-promiseunknown--void"},"fastify.preValidationHookHandler<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">(request: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyrequestrawserver-rawrequest-requestgeneric"},"FastifyRequest"),", reply: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyreplyrawserver-rawreply-contextconfig"},"FastifyReply"),", done: (err?: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyerror"},"FastifyError"),") => void): Promise\\<unknown",">"," | void"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/hooks.d.ts#L53"},"src")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"preValidation")," is the third hook to be executed in the request lifecycle. The\nprevious hook was ",(0,r.kt)("inlineCode",{parentName:"p"},"preParsing"),", the next hook will be ",(0,r.kt)("inlineCode",{parentName:"p"},"preHandler"),"."),(0,r.kt)("h5",{id:"fastifyprehandlerhookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-done-err-fastifyerror--void-promiseunknown--void"},"fastify.preHandlerHookHandler<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">(request: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyrequestrawserver-rawrequest-requestgeneric"},"FastifyRequest"),", reply: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyreplyrawserver-rawreply-contextconfig"},"FastifyReply"),", done: (err?: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyerror"},"FastifyError"),") => void): Promise\\<unknown",">"," | void"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/hooks.d.ts#L70"},"src")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"preHandler")," is the fourth hook to be executed in the request lifecycle. The\nprevious hook was ",(0,r.kt)("inlineCode",{parentName:"p"},"preValidation"),", the next hook will be ",(0,r.kt)("inlineCode",{parentName:"p"},"preSerialization"),"."),(0,r.kt)("h5",{id:"fastifypreserializationhookhandlerpreserializationpayload-rawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-payload-preserializationpayload-done-err-fastifyerror--null-res-unknown--void-promiseunknown--void"},"fastify.preSerializationHookHandler<PreSerializationPayload, ",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">(request: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyrequestrawserver-rawrequest-requestgeneric"},"FastifyRequest"),", reply: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyreplyrawserver-rawreply-contextconfig"},"FastifyReply"),", payload: PreSerializationPayload, done: (err: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyerror"},"FastifyError")," | null, res?: unknown) => void): Promise\\<unknown",">"," | void"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/hooks.d.ts#L94"},"src")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"preSerialization")," is the fifth hook to be executed in the request lifecycle.\nThe previous hook was ",(0,r.kt)("inlineCode",{parentName:"p"},"preHandler"),", the next hook will be ",(0,r.kt)("inlineCode",{parentName:"p"},"onSend"),"."),(0,r.kt)("p",null,"Note: the hook is NOT called if the payload is a string, a Buffer, a stream or\nnull."),(0,r.kt)("h5",{id:"fastifyonsendhookhandleronsendpayload-rawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-payload-onsendpayload-done-err-fastifyerror--null-res-unknown--void-promiseunknown--void"},"fastify.onSendHookHandler<OnSendPayload, ",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">(request: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyrequestrawserver-rawrequest-requestgeneric"},"FastifyRequest"),", reply: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyreplyrawserver-rawreply-contextconfig"},"FastifyReply"),", payload: OnSendPayload, done: (err: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyerror"},"FastifyError")," | null, res?: unknown) => void): Promise\\<unknown",">"," | void"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/hooks.d.ts#L114"},"src")),(0,r.kt)("p",null,"You can change the payload with the ",(0,r.kt)("inlineCode",{parentName:"p"},"onSend")," hook. It is the sixth hook to be\nexecuted in the request lifecycle. The previous hook was ",(0,r.kt)("inlineCode",{parentName:"p"},"preSerialization"),", the\nnext hook will be ",(0,r.kt)("inlineCode",{parentName:"p"},"onResponse"),"."),(0,r.kt)("p",null,"Note: If you change the payload, you may only change it to a string, a Buffer, a\nstream, or null."),(0,r.kt)("h5",{id:"fastifyonresponsehookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-done-err-fastifyerror--void-promiseunknown--void"},"fastify.onResponseHookHandler<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">(request: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyrequestrawserver-rawrequest-requestgeneric"},"FastifyRequest"),", reply: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyreplyrawserver-rawreply-contextconfig"},"FastifyReply"),", done: (err?: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyerror"},"FastifyError"),") => void): Promise\\<unknown",">"," | void"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/hooks.d.ts#L134"},"src")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"onResponse")," is the seventh and last hook in the request hook lifecycle. The\nprevious hook was ",(0,r.kt)("inlineCode",{parentName:"p"},"onSend"),", there is no next hook."),(0,r.kt)("p",null,"The onResponse hook is executed when a response has been sent, so you will not\nbe able to send more data to the client. It can however be useful for sending\ndata to external services, for example to gather statistics."),(0,r.kt)("h5",{id:"fastifyonerrorhookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigrequest-fastifyrequest-reply-fastifyreply-error-fastifyerror-done---void-promiseunknown--void"},"fastify.onErrorHookHandler<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">(request: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyrequestrawserver-rawrequest-requestgeneric"},"FastifyRequest"),", reply: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyreplyrawserver-rawreply-contextconfig"},"FastifyReply"),", error: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyerror"},"FastifyError"),", done: () => void): Promise\\<unknown",">"," | void"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/hooks.d.ts#L154"},"src")),(0,r.kt)("p",null,"This hook is useful if you need to do some custom error logging or add some\nspecific header in case of error."),(0,r.kt)("p",null,"It is not intended for changing the error, and calling reply.send will throw an\nexception."),(0,r.kt)("p",null,"This hook will be executed only after the customErrorHandler has been executed,\nand only if the customErrorHandler sends an error back to the user (Note that\nthe default customErrorHandler always sends the error back to the user)."),(0,r.kt)("p",null,"Notice: unlike the other hooks, pass an error to the done function is not\nsupported."),(0,r.kt)("h5",{id:"fastifyonroutehookhandlerrawserver-rawrequest-rawreply-requestgeneric-contextconfigopts-routeoptions---path-string-prefix-string--promiseunknown--void"},"fastify.onRouteHookHandler<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrequestgenericinterface"},"RequestGeneric"),", ",(0,r.kt)("a",{parentName:"h5",href:"#ContextConfigGeneric"},"ContextConfig"),">(opts: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyrouteoptionsrawserver-rawrequest-rawreply-requestgeneric-contextconfig"},"RouteOptions")," & { path: string; prefix: string }): Promise\\<unknown",">"," | void"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/hooks.d.ts#L174"},"src")),(0,r.kt)("p",null,"Triggered when a new route is registered. Listeners are passed a routeOptions\nobject as the sole parameter. The interface is synchronous, and, as such, the\nlistener does not get passed a callback"),(0,r.kt)("h5",{id:"fastifyonregisterhookhandlerrawserver-rawrequest-rawreply-loggerinstance-fastifyinstance-done-err-fastifyerror--void-promiseunknown--void"},"fastify.onRegisterHookHandler<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#logger"},"Logger"),">(instance: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyinstance"},"FastifyInstance"),", done: (err?: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyerror"},"FastifyError"),") => void): Promise\\<unknown",">"," | void"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/hooks.d.ts#L191"},"src")),(0,r.kt)("p",null,"Triggered when a new plugin is registered and a new encapsulation context is\ncreated. The hook will be executed before the registered code."),(0,r.kt)("p",null,"This hook can be useful if you are developing a plugin that needs to know when a\nplugin context is formed, and you want to operate in that specific context."),(0,r.kt)("p",null,"Note: This hook will not be called if a plugin is wrapped inside fastify-plugin."),(0,r.kt)("h5",{id:"fastifyonclosehookhandlerrawserver-rawrequest-rawreply-loggerinstance-fastifyinstance-done-err-fastifyerror--void-promiseunknown--void"},"fastify.onCloseHookHandler<",(0,r.kt)("a",{parentName:"h5",href:"#rawserver"},"RawServer"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawrequest"},"RawRequest"),", ",(0,r.kt)("a",{parentName:"h5",href:"#rawreply"},"RawReply"),", ",(0,r.kt)("a",{parentName:"h5",href:"#logger"},"Logger"),">(instance: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyinstance"},"FastifyInstance"),", done: (err?: ",(0,r.kt)("a",{parentName:"h5",href:"#fastifyfastifyerror"},"FastifyError"),") => void): Promise\\<unknown",">"," | void"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/fastify/fastify/blob/main/types/hooks.d.ts#L206"},"src")),(0,r.kt)("p",null,'Triggered when fastify.close() is invoked to stop the server. It is useful when\nplugins need a "shutdown" event, for example to close an open connection to a\ndatabase.'))}u.isMDXComponent=!0}}]);